<html>
<head>
<title> </title>
</head>
<body BGCOLOR=#eeeeff text=#000000 LINK=#0000ff VLINK=#000077 ALINK=#ff0000>
 
<table width=600><tr>
<td><a href="innerclasses.doc.html">目次</a> | <a href="innerclasses.doc4.html">前項目</a> | <a href="innerclasses.doc6.html">次項目</a> 
</td><td align=right><i>内部クラス仕様</i></td>
</tr></table>

<hr><br>
 
<a name="11031"></a>
<h1>内部クラスは Java コードの正しい同期に影響するか?</h1>
<a name="14480"></a>
内部クラスは 1 つの（または複数の）親クラスの実装の一部です。そのため、これはすべての親クラスの <code>private</code> メンバにアクセスします。これは、プログラマが <code>private</code> 変数に格納された状態への併行アクセスの可能性に注意し、非 <code>private</code> メソッドが正しく同期しているのを保証する必要があることを意味します。時にこれは、親メソッドを <code>synchronized</code> キーワードで宣言する必要があることだけを意味します。<p><a name="16631"></a>
<code>FixedStack</code> およびその列挙子のように、1 つ以上のオブジェクトが関わるとき、プログラマはどのインスタンスを同期化するかを選択し、親インスタンスに対して次のように明示的な <code>synchronized</code> 文を書く必要があります: 
<Table Border="0">
<caption></caption>
<tr><td><br><pre>    <a name="14483"></a>        public Object nextElement() {
    <a name="14484"></a>            ...
    <a name="14485"></a>            synchronized (FixedStack.this) {
    <a name="14486"></a>                return array[--count];
    <a name="14487"></a>            }
    <a name="14488"></a>        }
</pre>

</Table>

<!--
<Table>
<tr><td>
</Table>
--><p><a name="14478"></a>
内部クラスの <code>synchronized</code> メソッドと親インスタンスの間に特別な関係はありません。親インスタンスと同期化するためには、明示的な <code>synchronized</code> 文を使用します。<p><a name="16662"></a>
マルチスレッドコードを書くとき、プログラマは共有された状態変数への潜在的な非同期アクセスに常に注意する必要があります。非同期内部クラスは、 private フィールドまたはローカル変数を共有するスレッドの作成を極めて簡単にします。プログラマはこれらの変数へのアクセスを同期化すること、または各スレッドに対して別個のコピーをすることのどちらかに配慮する必要があります。例えば、この <code>for</code> ループは index 変数のコピーをする必要があります: 
<Table Border="0">
<caption></caption>
<tr><td><br><pre>    <a name="16681"></a>    for (int ii = 0; ii &lt; getBinCount(); ii++) {
    <a name="16711"></a>        final int i = ii; // capture a stable copy for each thread
    <a name="16712"></a>        Runnable r = new Runnable() {
    <a name="16713"></a>            public void run() { processBin(i); }
    <a name="16684"></a>        };
    <a name="16685"></a>        new Thread(r, "processBin("+i+")").start();
    <a name="16682"></a>    }
</pre>

</Table>

<!--
<Table>
<tr><td>
</Table>
--><p><a name="19968"></a>
内部クラス本体内でループ添字を使用しようとすることはよくある間違いです。添字は <code>final</code> でないため、コンパイラがエラーの報告をします。<p>

<hr>
<!-- This inserts footnotes--><p>
<a href="innerclasses.doc.html">目次</a> | <a href="innerclasses.doc4.html">前項目</a> | <a href="innerclasses.doc6.html">次項目</a> 

<p>
<font size=-1>内部クラス仕様 (HTML generated by dkramer on March 15, 1997)<br>
<i><a href="copyright.doc.html">Copyright (c) 1996, 1997 Sun Microsystems, Inc.</a>
All rights reserved</i>
<br>
コメントや訂正は <a href="mailto:john.rose@eng.sun.com">john.rose@eng.sun.com</a> 宛てに送ってください。
</font>
</body></html>
